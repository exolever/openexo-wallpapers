---
language: generic

env:
  global:
  - PACKAGE_NAME=openexo-wallpapers

before_install:
- export BUILD_VERSION=$(date "+%Y%m%d").$TRAVIS_BUILD_NUMBER
- if [ ! -z "$TRAVIS_TAG" ]; then export BUILD_VERSION=$TRAVIS_TAG; fi
- export PACKAGE_NAME_VERSION=$PACKAGE_NAME.$BUILD_VERSION.deb

script:
- if [ ! -z "$TRAVIS_TAG" ]; then sed -i "s/0.0.0/$TRAVIS_TAG/" DEBIAN/control; fi
- bash generate.sh
# Quick and dirty cleanup
- rm -rf generate.sh .travis.yml README.md .git
- dpkg-deb --build .
- mv ..deb $PACKAGE_NAME_VERSION

after_success:
- ls -l $PACKAGE_NAME_VERSION
- md5sum $PACKAGE_NAME_VERSION
- dpkg --contents $PACKAGE_NAME_VERSION

# Check this https://docs.travis-ci.com/user/deployment/launchpad/
deploy:
  provider: launchpad
slug: "openexo"
  oauth_token:
    secure: ucOeAWUzwVK+8GfmYhfhFCx0OWX5DB06KwjMrJt0rJ4barLJtrbTxgXQ7FM0tR98/FkUsd2tpVNwJWGLRu3kxCNfCnRIAmKsV4nwadPyYSSYI/HUnIIK9xCqJHxcvd1MjJKJYpXmn7QpJocIpx5SDXJ2/QdfjYYzL9kvUdAiJ4C52YqCyM6eB4+z0n0ywRbPsuSrNNiSOvU9SxB4uu0MJmMTTRQJZ/sZlHRzNSM6UceT12VSvBm1xlJgjFddsLcqpjoxKEzQqFTU6Li4Ozz2EuHGOoDRUB7sV+lFbjvhT49gDAXgMZ71DWMxedklL6/oASUvh8KCzt8FQXHE6deLj2XiP7bK8IQG0ub+eGsGO60KJfJFiHzs1G7yK0FkFxISlQ+xgheQ9guAHbx4sRSnCvMDpRn2eY4Ra7rZ/5x9anoevGOVziIXnCOPBdqo61NnoGf3HYKuZ5xbemSIzwE0PZAVpamaeWHbmetCpQJvUQdAYFlZMBgNmGZevn7a0cCSS2YrdzwHQBIXKXqJgwSzq+0ei7+MsOxUtMsy1QwLNAcLSklSOE4EsNUJNUJVaXu+5geV8Lnj94TL9aCa3NY22NYb4ikxTlA8JFphxmSkEDErwgqIGtn6hsSHeoa7f9jeMQatItgQFD1LmjN3BfFeQCk/8y06K+hlXNwHxFD4eqY=
  oauth_token_secret:
    secure: w+1k6Q6n5z2EMhO9ctryZMrhCVYDssjZwr/Meao9GOZVxKBTMH6NHWPdHqfGTGNDi3PUVruCyOmHfvlUAytEqOYvNOMOP+lZ0P8bQ/biQ+qjpBrV0KBB4a7IfiiA86JbgE66JRigUsOOEzD4a+tjz3c3n9Bxu0dp2JMBSXNa+e15LCd7r8FlcHe8UoBznqOCuDxk4bwdGQaxxsKT6GbxaHwnf9tkXsstyxHQNbeuAim+HKav6AfbGvVQU4WUiK+tMTPUwUgdXUBsF560Rf1bXnTqMfpOfi1T/wqyZt9epp6vvqe6AyV1QF/8vZHWVGLqlOvjARRy6uAzbR2bTmxDyGeIWi9496YpoipRwOdEavzLIylndXJ07qA811BGavtI6mfvImXijU9HWvfSUrq1hRu+8a5RKUMbD22jk7r2K0zvZqePmNWKaaimcnFj4G/4xoz2q25ajHy98LjQQ7J+gLSjffLBvIO0ObztQgPu2ACrXx8icJVBRYjoXpCytZYbGE4cwVcjhYT8JEOxVzBNm7aNdgtQsEGsZiAJN5soNOdma0EtrIRGpJAgku7xv/ovjf/s5mhcPiF98tPS35HFgpHTU2GUsSLGgm6i6RB8N/7OWZPMlNfJQVwtdjfmrKVbApO6ZOugDf8xktJ6AWgSo/dN+GjUhpHNyTKBhjYdqi4=
  on:
    tags: true

deploy:
  provider: releases
  api_key: "$GITHUB_TOKEN"
  file: "$PACKAGE_NAME_VERSION"
  skip_cleanup: true
  on:
    tags: true